clc;
clear all;
close all;

%sajat tanitohalmaz es elvart kimenetek
x=[ 1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1; %0
    1  0 0 0 0 0  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0  0 0 0 0 0; %0
    1  0 0 0 0 0  1 1 1 1 0  1 0 0 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 0  0 0 0 0 0; %0
    1  0 0 0 0 0  0 0 0 0 0  0 0 1 1 1  0 0 1 0 1  0 0 1 0 1  0 0 1 0 1  0 0 1 1 1; %0
    1  1 1 1 0 0  1 0 1 0 0  1 0 1 0 0  1 0 1 0 0  1 1 1 0 0  0 0 0 0 0  0 0 0 0 0; %0
    
    1  0 0 1 0 0  0 1 1 0 0  1 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 1 1 1 0; %1
    1  0 0 0 0 0  0 0 1 0 0  0 1 1 0 0  1 0 1 0 0  0 0 1 0 0  0 1 1 1 0  0 0 0 0 0; %1
    1  0 0 0 1 0  0 0 1 1 0  0 1 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 1 1 1; %1
    1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1; %1
    1  0 1 1 0 0  1 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 1 1 1 0  0 0 0 0 0  0 0 0 0 0; %1
    
    1  0 1 1 1 0  0 0 0 1 0  0 0 0 1 0  0 1 1 1 0  0 1 0 0 0  0 1 0 0 0  0 1 1 1 0; %2
    1  0 0 0 0 0  0 1 1 1 0  0 0 0 0 1  0 1 1 1 0  1 0 0 0 0  0 1 1 1 0  0 0 0 0 0; %2
    1  0 0 0 0 0  0 0 0 0 0  0 0 1 1 1  0 0 0 0 1  0 0 1 1 1  0 0 1 0 0  0 0 1 1 1; %2
    1  1 1 1 0 0  0 0 1 0 0  1 1 1 0 0  1 0 0 0 0  1 1 1 0 0  0 0 0 0 0  0 0 0 0 0; %2
    1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1; %2
    
    1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1; %3
    1  0 0 1 1 1  0 0 0 0 1  0 0 1 1 1  0 0 0 0 1  0 0 1 1 1  0 0 0 0 0  0 0 0 0 0; %3
    1  0 0 0 0 0  0 0 0 0 0  0 0 1 1 1  0 0 0 0 1  0 0 1 1 1  0 0 0 0 1  0 0 1 1 1; %3
    1  0 0 0 0 0  0 1 1 1 0  0 0 0 1 0  0 1 1 1 0  0 0 0 1 0  0 1 1 1 0  0 0 0 0 0; %3
    1  1 1 1 0 0  0 0 1 0 0  1 1 1 0 0  0 0 1 0 0  1 1 1 0 0  0 0 0 0 0  0 0 0 0 0; %3
    
    1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  0 0 0 0 1; %4
    1  0 0 1 0 0  0 1 1 0 0  1 1 1 1 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0  0 0 1 0 0; %4
    1  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0  0 0 1 1 0  0 1 1 1 1  0 0 0 1 0  0 0 0 1 0; %4
    1  0 0 0 1 0  0 0 1 1 0  0 1 1 1 1  0 0 0 1 0  0 0 0 1 0  0 0 0 0 0  0 0 0 0 0; %4
    1  0 0 0 0 0  0 0 1 0 0  0 1 1 0 0  1 1 1 1 0  0 0 1 0 0  0 0 1 0 0  0 0 0 0 0; %4
    
    1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1  0 0 0 0 1  0 0 0 0 1  1 1 1 1 1; %5
    1  0 0 0 0 0  0 1 1 1 0  0 1 0 0 0  0 1 1 1 0  0 0 0 1 0  0 1 1 1 0  0 0 0 0 0; %5
    1  0 0 0 0 0  0 0 0 0 0  1 1 1 0 0  1 0 0 0 0  1 1 1 0 0  0 0 1 0 0  1 1 1 0 0; %5
    1  0 0 0 0 0  0 0 1 1 1  0 0 1 0 0  0 0 1 1 1  0 0 0 0 1  0 0 1 1 1  0 0 0 0 0; %5
    1  1 1 1 0 0  1 0 0 0 0  1 0 0 0 0  1 1 1 0 0  0 0 1 0 0  0 0 1 0 0  1 1 1 0 0; %5
    
    1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1; %6
    1  0 0 0 0 0  1 1 1 1 0  1 0 0 0 0  1 1 1 1 0  1 0 0 1 0  1 1 1 1 0  0 0 0 0 0; %6
    1  0 0 0 0 0  0 1 1 1 1  0 1 0 0 0  0 1 1 1 1  0 1 0 0 1  0 1 1 1 1  0 0 0 0 0; %6
    1  0 0 0 0 0  0 0 0 0 0  0 1 1 1 1  0 1 0 0 0  0 1 1 1 1  0 1 0 0 1  0 1 1 1 1; %6
    1  0 0 0 0 0  0 0 0 0 0  1 1 1 1 0  1 0 0 0 0  1 1 1 1 0  1 0 0 1 0  1 1 1 1 0; %6
    
    1  1 1 1 1 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0  0 0 0 0 0; %7
    1  0 0 0 0 0  0 0 0 0 0  1 1 1 1 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0; %7
    1  0 0 0 0 0  0 0 0 0 0  1 1 1 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0; %7
    1  0 0 0 0 0  0 0 0 0 0  0 1 1 1 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  0 0 0 0 0; %7
    1  0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 1 1 1 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0; %7
    
    1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1  1 0 0 0 1  1 0 0 0 1  1 1 1 1 1; %8
    1  0 0 0 0 0  0 1 1 1 0  0 1 0 1 0  0 1 1 1 0  0 1 0 1 0  0 1 1 1 0  0 0 0 0 0; %8
    1  0 0 0 0 0  0 0 0 0 0  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0  1 0 1 0 0  1 1 1 0 0; %8
    1  0 0 0 0 0  0 0 0 0 0  0 0 1 1 1  0 0 1 0 1  0 0 1 1 1  0 0 1 0 1  0 0 1 1 1; %8
    1  0 0 1 1 1  0 0 1 0 1  0 0 1 1 1  0 0 1 0 1  0 0 1 1 1  0 0 0 0 0  0 0 0 0 0; %8
    
    1  1 1 1 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 0  0 0 0 1 0  1 1 1 1 0  0 0 0 0 0; %9
    1  0 1 1 1 1  0 1 0 0 1  0 1 0 0 1  0 1 1 1 1  0 0 0 0 1  0 0 0 0 1  0 1 1 1 1; %9
    1  1 1 1 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 0  0 0 0 1 0  0 0 0 1 0  1 1 1 1 0; %9
    1  0 0 0 0 0  1 1 1 1 0  1 0 0 1 0  1 0 0 1 0  1 1 1 1 0  0 0 0 1 0  1 1 1 1 0; %9
    1  0 0 0 0 0  0 1 1 1 1  0 1 0 0 1  0 1 0 0 1  0 1 1 1 1  0 0 0 0 1  0 1 1 1 1]; %9

    x_Teszt = [1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0; %0
               1  0 0 0 1 0  0 0 1 1 0  0 1 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 0; %1
               1  0 0 0 0 0  1 1 1 0 0  0 0 1 0 0  0 0 1 0 0  1 1 1 0 0  1 0 0 0 0  1 1 1 0 0; %2
               1  0 1 1 1 0  1 0 0 0 1  0 0 0 0 1  0 1 1 1 0  0 0 0 0 1  1 0 0 0 1  0 1 1 1 0; %3
               1  0 0 0 1 0  0 0 1 1 0  0 1 0 1 0  1 0 0 1 0  1 1 1 1 1  0 0 0 1 0  0 0 0 1 0; %4
               1  1 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 0  0 0 0 0 1  0 0 0 0 1  1 1 1 1 0; %5
               1  0 1 1 1 1  1 0 0 0 0  1 0 0 0 0  1 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0; %6
               1  1 1 1 1 1  0 0 0 0 1  0 0 0 1 0  0 0 1 0 0  0 1 0 0 0  1 0 0 0 0  0 0 0 0 0; %7
               1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0  1 0 0 0 1  1 0 0 0 1  0 1 1 1 0; %8
               1  0 0 0 0 0  0 1 1 1 0  0 1 0 1 0  0 1 1 1 0  0 0 0 1 0  0 1 1 1 0  0 0 0 0 0]; %9
           
   d=[1 -1 -1 -1 -1 -1 -1 -1 -1 -1; %0
      1 -1 -1 -1 -1 -1 -1 -1 -1 -1; %0
      1 -1 -1 -1 -1 -1 -1 -1 -1 -1; %0
      1 -1 -1 -1 -1 -1 -1 -1 -1 -1; %0
      1 -1 -1 -1 -1 -1 -1 -1 -1 -1; %0
      
	  -1 1 -1 -1 -1 -1 -1 -1 -1 -1; %1
      -1 1 -1 -1 -1 -1 -1 -1 -1 -1; %1
      -1 1 -1 -1 -1 -1 -1 -1 -1 -1; %1
      -1 1 -1 -1 -1 -1 -1 -1 -1 -1; %1
      -1 1 -1 -1 -1 -1 -1 -1 -1 -1; %1
      
	  -1 -1 1 -1 -1 -1 -1 -1 -1 -1; %2
      -1 -1 1 -1 -1 -1 -1 -1 -1 -1; %2
      -1 -1 1 -1 -1 -1 -1 -1 -1 -1; %2
      -1 -1 1 -1 -1 -1 -1 -1 -1 -1; %2
      -1 -1 1 -1 -1 -1 -1 -1 -1 -1; %2
      
	  -1 -1 -1 1 -1 -1 -1 -1 -1 -1; %3
      -1 -1 -1 1 -1 -1 -1 -1 -1 -1; %3
      -1 -1 -1 1 -1 -1 -1 -1 -1 -1; %3
      -1 -1 -1 1 -1 -1 -1 -1 -1 -1; %3
      -1 -1 -1 1 -1 -1 -1 -1 -1 -1; %3
      
      -1 -1 -1 -1 1 -1 -1 -1 -1 -1; %4
      -1 -1 -1 -1 1 -1 -1 -1 -1 -1; %4
      -1 -1 -1 -1 1 -1 -1 -1 -1 -1; %4
      -1 -1 -1 -1 1 -1 -1 -1 -1 -1; %4
      -1 -1 -1 -1 1 -1 -1 -1 -1 -1; %4
      
      -1 -1 -1 -1 -1 1 -1 -1 -1 -1; %5
      -1 -1 -1 -1 -1 1 -1 -1 -1 -1; %5
      -1 -1 -1 -1 -1 1 -1 -1 -1 -1; %5
      -1 -1 -1 -1 -1 1 -1 -1 -1 -1; %5
      -1 -1 -1 -1 -1 1 -1 -1 -1 -1; %5
      
      -1 -1 -1 -1 -1 -1 1 -1 -1 -1; %6
      -1 -1 -1 -1 -1 -1 1 -1 -1 -1; %6
      -1 -1 -1 -1 -1 -1 1 -1 -1 -1; %6
      -1 -1 -1 -1 -1 -1 1 -1 -1 -1; %6
      -1 -1 -1 -1 -1 -1 1 -1 -1 -1; %6
      
      -1 -1 -1 -1 -1 -1 -1 1 -1 -1; %7
      -1 -1 -1 -1 -1 -1 -1 1 -1 -1; %7
      -1 -1 -1 -1 -1 -1 -1 1 -1 -1; %7
      -1 -1 -1 -1 -1 -1 -1 1 -1 -1; %7
      -1 -1 -1 -1 -1 -1 -1 1 -1 -1; %7
      
      -1 -1 -1 -1 -1 -1 -1 -1 1 -1; %8
      -1 -1 -1 -1 -1 -1 -1 -1 1 -1; %8
      -1 -1 -1 -1 -1 -1 -1 -1 1 -1; %8
      -1 -1 -1 -1 -1 -1 -1 -1 1 -1; %8
      -1 -1 -1 -1 -1 -1 -1 -1 1 -1; %8
      
      -1 -1 -1 -1 -1 -1 -1 -1 -1 1; %9
      -1 -1 -1 -1 -1 -1 -1 -1 -1 1; %9
      -1 -1 -1 -1 -1 -1 -1 -1 -1 1; %9
      -1 -1 -1 -1 -1 -1 -1 -1 -1 1; %9
      -1 -1 -1 -1 -1 -1 -1 -1 -1 1]; %9

d_Teszt=[1 -1 -1 -1 -1 -1 -1 -1 -1 -1; %0
         -1 1 -1 -1 -1 -1 -1 -1 -1 -1; %1
         -1 -1 1 -1 -1 -1 -1 -1 -1 -1; %2 
         -1 -1 -1 1 -1 -1 -1 -1 -1 -1; %3
         -1 -1 -1 -1 1 -1 -1 -1 -1 -1; %4
         -1 -1 -1 -1 -1 1 -1 -1 -1 -1; %5
         -1 -1 -1 -1 -1 -1 1 -1 -1 -1; %6
         -1 -1 -1 -1 -1 -1 -1 1 -1 -1; %7
         -1 -1 -1 -1 -1 -1 -1 -1 1 -1; %8
         -1 -1 -1 -1 -1 -1 -1 -1 -1 1]; %9

% aktivacios fuggveny meghatarozasa
theta = @tansig;
dtheta = @(x) 1-theta(x).*theta(x);

% neuronok szama
layers = [36 15 10];

W = genbackprop(x, d, layers, theta, dtheta, 5000, 0.01, 0.003);


[n, m] = size(d_Teszt);
for i=1:n
    x1=x_Teszt(i,:)';      
    s1=W{1}*x1;       
    y1=theta(s1);%       
    x2=[y1];          
    s2=W{2}*x2;            
    y2{i}=theta(s2); 
end

for i=1:n
    for j=1:m
        temp=y2{i}(i);
        if y2{i}(j)==temp
            kapott(i)=j-1;
        end
        if d_Teszt(i,j)==1
            elvart(i)=j-1;
        end
    end
end
t1=0:9;
figure(1)
plot(t1,kapott,'g*');

confusion_matrix=zeros(10,10);
for i=1:10
    for j=1:10
        if kapott(j)==elvart(i)
            confusion_matrix(i,j)=confusion_matrix(i,j)+1;
        end
    end
end
confusion_matrix